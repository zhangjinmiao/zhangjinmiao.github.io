<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>21 分钟 MySQL 教程 &mdash; 山川尽美</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/pastie.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/vendor/share.js/dist/css/share.min.css"><link rel="canonical" href="http://zhangjinmiao.github.io/mysql/2018/04/24/21%E5%88%86%E9%92%9FMysql%E6%95%99%E7%A8%8B.html"><link rel="alternate" type="application/atom+xml" title="山川尽美" href="http://zhangjinmiao.github.io"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/favicon.ico"><meta property="og:title" content="21 分钟 MySQL 教程"><meta name="keywords" content="mysql, 21 分钟"><meta name="og:keywords" content="mysql, 21 分钟"><meta name="description" content="为什么只需要 21 分钟呢？因为在我们大天朝有句话叫做三七二十一，你可以不管三七二十一开始使用 MySQL 及快速的方式入门 MySQL。其实 21 分钟把下面语句之行一遍是没有问题的，要理解的话估计不止 21 分钟，对于初学者来说只需满足自己需求可以增删改查等简易的维护即可。"><meta name="og:description" content="为什么只需要 21 分钟呢？因为在我们大天朝有句话叫做三七二十一，你可以不管三七二十一开始使用 MySQL 及快速的方式入门 MySQL。其实 21 分钟把下面语句之行一遍是没有问题的，要理解的话估计不止 21 分钟，对于初学者来说只需满足自己需求可以增删改查等简易的维护即可。"><meta property="og:url" content="http://zhangjinmiao.github.io/mysql/2018/04/24/21%E5%88%86%E9%92%9FMysql%E6%95%99%E7%A8%8B.html"><meta property="og:site_name" content="山川尽美"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2018-04-24"> <script src="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/js/main.js"></script> <script data-ad-client="ca-pub-7093222719567591" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="http://zhangjinmiao.github.io/" title="山川尽美"><span class="octicon octicon-mark-github"></span> 山川尽美</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="http://zhangjinmiao.github.io/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="http://zhangjinmiao.github.io/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="http://zhangjinmiao.github.io/archives/" class=" site-header-nav-item" target="" title="归档">归档</a> <a href="http://zhangjinmiao.github.io/spring-boot.html" class=" site-header-nav-item" target="_blank" title="Spring Boot">Spring Boot</a> <a href="http://zhangjinmiao.github.io/payment.html" class=" site-header-nav-item" target="_blank" title="支付">支付</a> <a href="http://zhangjinmiao.github.io/about.html" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="21 分钟 MySQL 教程"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">21 分钟 MySQL 教程</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2018/04/24 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="http://zhangjinmiao.github.io/categories/#MySQL" title="MySQL">MySQL</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 10963 字，约 32 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"> <img style="height:72px;width:72px" src="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/images/qrcode.jpg" alt="山川尽美" /></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths"><article class="article-content markdown-body"><p>为什么只需要 21 分钟呢？因为在我们大天朝有句话叫做三七二十一，你可以不管三七二十一开始使用 <code class="language-plaintext highlighter-rouge">MySQL</code> 及快速的方式入门 <code class="language-plaintext highlighter-rouge">MySQL</code>。其实 21 分钟把下面语句之行一遍是没有问题的，要理解的话估计不止 21 分钟，对于初学者来说只需满足自己需求可以增删改查等简易的维护即可。</p><h2 id="开始使用">开始使用</h2><p>我下面所有的 SQL 语句是基于 MySQL 5.6+运行。</p><p>MySQL 为关系型数据库(Relational Database Management System)，一个关系型数据库由一个或数个表格组成, 如图所示的一个表格：</p><p><img src="https://github.com/zhangjinmiao/zhangjinmiao.github.io/raw/master/assets/images/2018/mysql/data.jpg" alt="data" /></p><ul><li><code class="language-plaintext highlighter-rouge">表头(header)</code>: 每一列的名称;</li><li><code class="language-plaintext highlighter-rouge">列(col)</code>: 具有相同数据类型的数据的集合;</li><li><code class="language-plaintext highlighter-rouge">行(row)</code>: 每一行用来描述某个人/物的具体信息;</li><li><code class="language-plaintext highlighter-rouge">值(value)</code>: 行的具体信息, 每个值必须与该列的数据类型相同;</li><li><code class="language-plaintext highlighter-rouge">键(key)</code>: 表中用来识别某个特定的人\物的方法, 键的值在当前列中具有唯一性。</li></ul><h3 id="登录-mysql">登录 MySQL</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql <span class="nt">-h</span> 127.0.0.1 <span class="nt">-u</span> 用户名 <span class="nt">-p</span>
mysql <span class="nt">-D</span> 所选择的数据库名 <span class="nt">-h</span> 主机名 <span class="nt">-u</span> 用户名 <span class="nt">-p</span>
mysql&gt; <span class="nb">exit</span> <span class="c"># 退出 使用 “quit;” 或 “\q;” 一样的效果</span>
mysql&gt; status<span class="p">;</span>  <span class="c"># 显示当前mysql的version的各种信息</span>
mysql&gt; <span class="k">select </span>version<span class="o">()</span><span class="p">;</span> <span class="c"># 显示当前mysql的version信息</span>
mysql&gt; show global variables like <span class="s1">'port'</span><span class="p">;</span> <span class="c"># 查看MySQL端口号</span>
</code></pre></div></div><h3 id="创建数据库">创建数据库</h3><p>对于表的操作需要先进入库<code class="language-plaintext highlighter-rouge">use 库名;</code></p><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 创建一个名为 samp_db 的数据库，数据库字符编码指定为 gbk</span>
<span class="k">create</span> <span class="k">database</span> <span class="n">samp_db</span> <span class="nb">character</span> <span class="k">set</span> <span class="n">gbk</span><span class="p">;</span>
<span class="k">drop</span> <span class="k">database</span> <span class="n">samp_db</span><span class="p">;</span> <span class="c1">-- 删除 库名为samp_db的库</span>
<span class="k">show</span> <span class="n">databases</span><span class="p">;</span>        <span class="c1">-- 显示数据库列表。</span>
<span class="n">use</span> <span class="n">samp_db</span><span class="p">;</span>     <span class="c1">-- 选择创建的数据库samp_db</span>
<span class="k">show</span> <span class="n">tables</span><span class="p">;</span>     <span class="c1">-- 显示samp_db下面所有的表名字</span>
<span class="k">describe</span> <span class="err">表名</span><span class="p">;</span>    <span class="c1">-- 显示数据表的结构</span>
<span class="k">delete</span> <span class="k">from</span> <span class="err">表名</span><span class="p">;</span> <span class="c1">-- 清空表中记录</span>
</code></pre></div></div><h3 id="创建数据库表">创建数据库表</h3><blockquote><p>使用 create table 语句可完成对表的创建, create table 的常见形式: 语法：create table 表名称(列声明);</p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 如果数据库中存在user_accounts表，就把它从数据库中drop掉</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="nv">`user_accounts`</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`user_accounts`</span> <span class="p">(</span>
  <span class="nv">`id`</span>             <span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="nv">`password`</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>       <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'用户密码'</span><span class="p">,</span>
  <span class="nv">`reset_password`</span> <span class="nb">tinyint</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>       <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">0</span> <span class="k">COMMENT</span> <span class="s1">'用户类型：0－不需要重置密码；1-需要重置密码'</span><span class="p">,</span>
  <span class="nv">`mobile`</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>       <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'手机'</span><span class="p">,</span>
  <span class="nv">`create_at`</span>      <span class="nb">timestamp</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>      <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
  <span class="nv">`update_at`</span>      <span class="nb">timestamp</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>      <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
  <span class="c1">-- 创建唯一索引，不允许重复</span>
  <span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="n">idx_user_mobile</span><span class="p">(</span><span class="nv">`mobile`</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span>
<span class="k">COMMENT</span><span class="o">=</span><span class="s1">'用户表信息'</span><span class="p">;</span>
</code></pre></div></div><p>数据类型的属性解释</p><ul><li><code class="language-plaintext highlighter-rouge">NULL</code>：数据列可包含 NULL 值；</li><li><code class="language-plaintext highlighter-rouge">NOT NULL</code>：数据列不允许包含 NULL 值；</li><li><code class="language-plaintext highlighter-rouge">DEFAULT</code>：默认值；</li><li><code class="language-plaintext highlighter-rouge">PRIMARY</code>：KEY 主键；</li><li><code class="language-plaintext highlighter-rouge">AUTO_INCREMENT</code>：自动递增，适用于整数类型；</li><li><code class="language-plaintext highlighter-rouge">UNSIGNED</code>：是指数值类型只能为正数；</li><li><code class="language-plaintext highlighter-rouge">CHARACTER SET name</code>：指定一个字符集；</li><li><code class="language-plaintext highlighter-rouge">COMMENT</code>：对表或者字段说明；</li></ul><h2 id="增删改查">增删改查</h2><h3 id="select">SELECT</h3><blockquote><p>SELECT 语句用于从表中选取数据。<br /> 语法：<code class="language-plaintext highlighter-rouge">SELECT 列名称 FROM 表名称</code><br /> 语法：<code class="language-plaintext highlighter-rouge">SELECT * FROM 表名称</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 表station取个别名叫s，表station中不包含 字段id=13或者14 的，并且id不等于4的 查询出来，只显示id</span>
<span class="k">SELECT</span> <span class="n">s</span><span class="p">.</span><span class="n">id</span> <span class="k">from</span> <span class="n">station</span> <span class="n">s</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="k">and</span> <span class="n">id</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c1">-- 从表 Persons 选取 LastName 列的数据</span>
<span class="k">SELECT</span> <span class="n">LastName</span> <span class="k">FROM</span> <span class="n">Persons</span>

<span class="c1">-- 从表 users 选取 id=3 的数据，并只拉一条数据(据说能优化性能)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="mi">3</span> <span class="k">limit</span> <span class="mi">1</span>

<span class="c1">-- 结果集中会自动去重复数据</span>
<span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">Company</span> <span class="k">FROM</span> <span class="n">Orders</span> 
<span class="c1">-- 表 Persons 字段 Id_P 等于 Orders 字段 Id_P 的值，</span>
<span class="c1">-- 结果集显示 Persons表的 LastName、FirstName字段，Orders表的OrderNo字段</span>
<span class="k">SELECT</span> <span class="n">p</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderNo</span> <span class="k">FROM</span> <span class="n">Persons</span> <span class="n">p</span><span class="p">,</span> <span class="n">Orders</span> <span class="n">o</span> <span class="k">WHERE</span> <span class="n">p</span><span class="p">.</span><span class="n">Id_P</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">Id_P</span> 

<span class="c1">-- gbk 和 utf8 中英文混合排序最简单的办法 </span>
<span class="c1">-- ci是 case insensitive, 即 “大小写不敏感”</span>
<span class="k">SELECT</span> <span class="n">tag</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">from</span> <span class="n">news</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">tag</span> <span class="k">order</span> <span class="k">by</span> <span class="k">convert</span><span class="p">(</span><span class="n">tag</span> <span class="k">using</span> <span class="n">gbk</span><span class="p">)</span> <span class="k">collate</span> <span class="n">gbk_chinese_ci</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="n">tag</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">from</span> <span class="n">news</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">tag</span> <span class="k">order</span> <span class="k">by</span> <span class="k">convert</span><span class="p">(</span><span class="n">tag</span> <span class="k">using</span> <span class="n">utf8</span><span class="p">)</span> <span class="k">collate</span> <span class="n">utf8_unicode_ci</span><span class="p">;</span>
</code></pre></div></div><h3 id="update">UPDATE</h3><blockquote><p>Update 语句用于修改表中的数据。<br /> 语法：<code class="language-plaintext highlighter-rouge">UPDATE 表名称 SET 列名称 = 新值 WHERE 列名称 = 某值</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- update语句设置字段值为另一个结果取出来的字段</span>
<span class="k">update</span> <span class="k">user</span> <span class="k">set</span> <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="n">user1</span> <span class="k">where</span> <span class="n">user1</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span>
<span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="p">(</span><span class="k">select</span> <span class="n">id</span> <span class="k">from</span> <span class="n">user2</span> <span class="k">where</span> <span class="n">user2</span> <span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s1">'小苏'</span><span class="p">);</span>
<span class="c1">-- 更新表 orders 中 id=1 的那一行数据更新它的 title 字段</span>
<span class="k">UPDATE</span> <span class="nv">`orders`</span> <span class="k">set</span> <span class="n">title</span><span class="o">=</span><span class="s1">'这里是标题'</span> <span class="k">WHERE</span> <span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div></div><h3 id="insert">INSERT</h3><blockquote><p>INSERT INTO 语句用于向表格中插入新的行。<br /> 语法：<code class="language-plaintext highlighter-rouge">INSERT INTO 表名称 VALUES (值1, 值2,....)</code><br /> 语法：<code class="language-plaintext highlighter-rouge">INSERT INTO 表名称 (列1, 列2,...) VALUES (值1, 值2,....)</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 向表 Persons 插入一条字段 LastName = JSLite 字段 Address = shanghai</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Persons</span> <span class="p">(</span><span class="n">LastName</span><span class="p">,</span> <span class="n">Address</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'JSLite'</span><span class="p">,</span> <span class="s1">'shanghai'</span><span class="p">);</span>
<span class="c1">-- 向表 meeting 插入 字段 a=1 和字段 b=2</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">meeting</span> <span class="k">SET</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="c1">-- </span>
<span class="c1">-- SQL实现将一个表的数据插入到另外一个表的代码</span>
<span class="c1">-- 如果只希望导入指定字段，可以用这种方法：</span>
<span class="c1">-- INSERT INTO 目标表 (字段1, 字段2, ...) SELECT 字段1, 字段2, ... FROM 来源表;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">orders</span> <span class="p">(</span><span class="n">user_account_id</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="k">SELECT</span> <span class="n">m</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">m</span><span class="p">.</span><span class="n">title</span> <span class="k">FROM</span> <span class="n">meeting</span> <span class="n">m</span> <span class="k">where</span> <span class="n">m</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

<span class="c1">-- 向表 charger 插入一条数据，已存在就对表 charger 更新 `type`,`update_at` 字段；</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nv">`charger`</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">,</span><span class="nv">`type`</span><span class="p">,</span><span class="nv">`create_at`</span><span class="p">,</span><span class="nv">`update_at`</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">'2017-05-18 11:06:17'</span><span class="p">,</span><span class="s1">'2017-05-18 11:06:17'</span><span class="p">)</span> <span class="k">ON</span> <span class="n">DUPLICATE</span> <span class="k">KEY</span> <span class="k">UPDATE</span> <span class="nv">`id`</span><span class="o">=</span><span class="k">VALUES</span><span class="p">(</span><span class="nv">`id`</span><span class="p">),</span> <span class="nv">`type`</span><span class="o">=</span><span class="k">VALUES</span><span class="p">(</span><span class="nv">`type`</span><span class="p">),</span> <span class="nv">`update_at`</span><span class="o">=</span><span class="k">VALUES</span><span class="p">(</span><span class="nv">`update_at`</span><span class="p">);</span>
</code></pre></div></div><h3 id="delete">DELETE</h3><blockquote><p>DELETE 语句用于删除表中的行。<br /> 语法：<code class="language-plaintext highlighter-rouge">DELETE FROM 表名称 WHERE 列名称 = 值</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 在不删除table_name表的情况下删除所有的行，清空表。</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">table_name</span>
<span class="c1">-- 或者</span>
<span class="k">DELETE</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">table_name</span>
<span class="c1">-- 删除 Person表字段 LastName = 'JSLite' </span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Person</span> <span class="k">WHERE</span> <span class="n">LastName</span> <span class="o">=</span> <span class="s1">'JSLite'</span> 
<span class="c1">-- 删除 表meeting id 为2和3的两条数据</span>
<span class="k">DELETE</span> <span class="k">from</span> <span class="n">meeting</span> <span class="k">where</span> <span class="n">id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</code></pre></div></div><h2 id="where">WHERE</h2><blockquote><p>WHERE 子句用于规定选择的标准。<br /> 语法：<code class="language-plaintext highlighter-rouge">SELECT 列名称 FROM 表名称 WHERE 列 运算符 值</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 从表 Persons 中选出 Year 字段大于 1965 的数据</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Persons</span> <span class="k">WHERE</span> <span class="nb">Year</span><span class="o">&gt;</span><span class="mi">1965</span>
</code></pre></div></div><h2 id="and-和-or">AND 和 OR</h2><blockquote><p>AND - 如果第一个条件和第二个条件都成立；<br /> OR - 如果第一个条件和第二个条件中只要有一个成立；</p></blockquote><h3 id="and">AND</h3><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 删除 meeting 表字段 </span>
<span class="c1">-- id=2 并且 user_id=5 的数据  和</span>
<span class="c1">-- id=3 并且 user_id=6 的数据 </span>
<span class="k">DELETE</span> <span class="k">from</span> <span class="n">meeting</span> <span class="k">where</span> <span class="n">id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="k">and</span> <span class="n">user_id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>

<span class="c1">-- 使用 AND 来显示所有姓为 "Carter" 并且名为 "Thomas" 的人：</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Persons</span> <span class="k">WHERE</span> <span class="n">FirstName</span><span class="o">=</span><span class="s1">'Thomas'</span> <span class="k">AND</span> <span class="n">LastName</span><span class="o">=</span><span class="s1">'Carter'</span><span class="p">;</span>
</code></pre></div></div><h3 id="or">OR</h3><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 使用 OR 来显示所有姓为 "Carter" 或者名为 "Thomas" 的人：</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Persons</span> <span class="k">WHERE</span> <span class="n">firstname</span><span class="o">=</span><span class="s1">'Thomas'</span> <span class="k">OR</span> <span class="n">lastname</span><span class="o">=</span><span class="s1">'Carter'</span>
</code></pre></div></div><h2 id="order-by">ORDER BY</h2><blockquote><p>语句默认按照升序对记录进行排序。<br /> <code class="language-plaintext highlighter-rouge">ORDER BY</code> - 语句用于根据指定的列对结果集进行排序。<br /> <code class="language-plaintext highlighter-rouge">DESC</code> - 按照降序对记录进行排序。<br /> <code class="language-plaintext highlighter-rouge">ASC</code> - 按照顺序对记录进行排序。</p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Company在表Orders中为字母，则会以字母顺序显示公司名称</span>
<span class="k">SELECT</span> <span class="n">Company</span><span class="p">,</span> <span class="n">OrderNumber</span> <span class="k">FROM</span> <span class="n">Orders</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Company</span>

<span class="c1">-- 后面跟上 DESC 则为降序显示</span>
<span class="k">SELECT</span> <span class="n">Company</span><span class="p">,</span> <span class="n">OrderNumber</span> <span class="k">FROM</span> <span class="n">Orders</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Company</span> <span class="k">DESC</span>

<span class="c1">-- Company以降序显示公司名称，并OrderNumber以顺序显示</span>
<span class="k">SELECT</span> <span class="n">Company</span><span class="p">,</span> <span class="n">OrderNumber</span> <span class="k">FROM</span> <span class="n">Orders</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Company</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">OrderNumber</span> <span class="k">ASC</span>
</code></pre></div></div><h2 id="in">IN</h2><blockquote><p>IN - 操作符允许我们在 WHERE 子句中规定多个值。<br /> IN - 操作符用来指定范围，范围中的每一条，都进行匹配。IN 取值规律，由逗号分割，全部放置括号中。 语法：<code class="language-plaintext highlighter-rouge">SELECT "字段名"FROM "表格名"WHERE "字段名" IN ('值一', '值二', ...);</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 从表 Persons 选取 字段 LastName 等于 Adams、Carter</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Persons</span> <span class="k">WHERE</span> <span class="n">LastName</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'Adams'</span><span class="p">,</span><span class="s1">'Carter'</span><span class="p">)</span>
</code></pre></div></div><h2 id="not">NOT</h2><blockquote><p>NOT - 操作符总是与其他操作符一起使用，用在要过滤的前面。</p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">vend_id</span><span class="p">,</span> <span class="n">prod_name</span> <span class="k">FROM</span> <span class="n">Products</span> <span class="k">WHERE</span> <span class="k">NOT</span> <span class="n">vend_id</span> <span class="o">=</span> <span class="s1">'DLL01'</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">prod_name</span><span class="p">;</span>
</code></pre></div></div><h2 id="union">UNION</h2><blockquote><p>UNION - 操作符用于合并两个或多个 SELECT 语句的结果集。</p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 列出所有在中国表（Employees_China）和美国（Employees_USA）的不同的雇员名</span>
<span class="k">SELECT</span> <span class="n">E_Name</span> <span class="k">FROM</span> <span class="n">Employees_China</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="n">E_Name</span> <span class="k">FROM</span> <span class="n">Employees_USA</span>

<span class="c1">-- 列出 meeting 表中的 pic_url，</span>
<span class="c1">-- station 表中的 number_station 别名设置成 pic_url 避免字段不一样报错</span>
<span class="c1">-- 按更新时间排序</span>
<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span><span class="n">pic_url</span> <span class="k">FROM</span> <span class="n">meeting</span> <span class="k">UNION</span> <span class="k">ALL</span> <span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span><span class="n">number_station</span> <span class="k">AS</span> <span class="n">pic_url</span> <span class="k">FROM</span> <span class="n">station</span>  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">update_at</span><span class="p">;</span>
<span class="c1">-- 通过 UNION 语法同时查询了 products 表 和 comments 表的总记录数，并且按照 count 排序</span>
<span class="k">SELECT</span> <span class="s1">'product'</span> <span class="k">AS</span> <span class="k">type</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="k">count</span> <span class="k">FROM</span> <span class="nv">`products`</span> <span class="k">union</span> <span class="k">select</span> <span class="s1">'comment'</span> <span class="k">as</span> <span class="k">type</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="k">count</span> <span class="k">FROM</span> <span class="nv">`comments`</span> <span class="k">order</span> <span class="k">by</span> <span class="k">count</span><span class="p">;</span>
</code></pre></div></div><h2 id="as">AS</h2><blockquote><p>as - 可理解为：用作、当成，作为；别名<br /> 一般是重命名列名或者表名。<br /> 语法：<code class="language-plaintext highlighter-rouge">select column_1 as 列1,column_2 as 列2 from table as 表</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Employee</span> <span class="k">AS</span> <span class="n">emp</span>
<span class="c1">-- 这句意思是查找所有Employee 表里面的数据，并把Employee表格命名为 emp。</span>
<span class="c1">-- 当你命名一个表之后，你可以在下面用 emp 代替 Employee.</span>
<span class="c1">-- 例如 SELECT * FROM emp.</span>

<span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">OrderPrice</span><span class="p">)</span> <span class="k">AS</span> <span class="n">LargestOrderPrice</span> <span class="k">FROM</span> <span class="n">Orders</span>
<span class="c1">-- 列出表 Orders 字段 OrderPrice 列最大值，</span>
<span class="c1">-- 结果集列不显示 OrderPrice 显示 LargestOrderPrice</span>

<span class="c1">-- 显示表 users_profile 中的 name 列</span>
<span class="k">SELECT</span> <span class="n">t</span><span class="p">.</span><span class="n">name</span> <span class="k">from</span> <span class="p">(</span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users_profile</span> <span class="n">a</span><span class="p">)</span> <span class="k">AS</span> <span class="n">t</span><span class="p">;</span>

<span class="c1">-- 表 user_accounts 命名别名 ua，表 users_profile 命名别名 up</span>
<span class="c1">-- 满足条件 表 user_accounts 字段 id 等于 表 users_profile 字段 user_id</span>
<span class="c1">-- 结果集只显示mobile、name两列</span>
<span class="k">SELECT</span> <span class="n">ua</span><span class="p">.</span><span class="n">mobile</span><span class="p">,</span><span class="n">up</span><span class="p">.</span><span class="n">name</span> <span class="k">FROM</span> <span class="n">user_accounts</span> <span class="k">as</span> <span class="n">ua</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">users_profile</span> <span class="k">as</span> <span class="n">up</span> <span class="k">ON</span> <span class="n">ua</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">up</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>
</code></pre></div></div><h2 id="join">JOIN</h2><blockquote><p>用于根据两个或多个表中的列之间的关系，从这些表中查询数据。</p></blockquote><ul><li><code class="language-plaintext highlighter-rouge">JOIN</code>: 如果表中有至少一个匹配，则返回行</li><li><code class="language-plaintext highlighter-rouge">INNER JOIN</code>:在表中存在至少一个匹配时，INNER JOIN 关键字返回行。</li><li><code class="language-plaintext highlighter-rouge">LEFT JOIN</code>: 即使右表中没有匹配，也从左表返回所有的行</li><li><code class="language-plaintext highlighter-rouge">RIGHT JOIN</code>: 即使左表中没有匹配，也从右表返回所有的行</li><li><code class="language-plaintext highlighter-rouge">FULL JOIN</code>: 只要其中一个表中存在匹配，就返回行</li></ul><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Persons</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span> <span class="n">Persons</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">Orders</span><span class="p">.</span><span class="n">OrderNo</span>
<span class="k">FROM</span> <span class="n">Persons</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Orders</span>
<span class="k">ON</span> <span class="n">Persons</span><span class="p">.</span><span class="n">Id_P</span> <span class="o">=</span> <span class="n">Orders</span><span class="p">.</span><span class="n">Id_P</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Persons</span><span class="p">.</span><span class="n">LastName</span><span class="p">;</span>
</code></pre></div></div><h2 id="sql-函数">SQL 函数</h2><h3 id="count">COUNT</h3><blockquote><p>COUNT 让我们能够数出在表格中有多少笔资料被选出来。<br /> 语法：<code class="language-plaintext highlighter-rouge">SELECT COUNT("字段名") FROM "表格名";</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 表 Store_Information 有几笔 store_name 栏不是空白的资料。</span>
<span class="c1">-- "IS NOT NULL" 是 "这个栏位不是空白" 的意思。</span>
<span class="k">SELECT</span> <span class="k">COUNT</span> <span class="p">(</span><span class="n">Store_Name</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">Store_Information</span> <span class="k">WHERE</span> <span class="n">Store_Name</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span> 
<span class="c1">-- 获取 Persons 表的总数</span>
<span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">AS</span> <span class="n">totals</span> <span class="k">FROM</span> <span class="n">Persons</span><span class="p">;</span>
<span class="c1">-- 获取表 station 字段 user_id 相同的总数</span>
<span class="k">select</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">totals</span> <span class="k">from</span> <span class="n">station</span> <span class="k">group</span> <span class="k">by</span> <span class="n">user_id</span><span class="p">;</span>
</code></pre></div></div><h3 id="max">MAX</h3><blockquote><p>MAX 函数返回一列中的最大值。NULL 值不包括在计算中。<br /> 语法：<code class="language-plaintext highlighter-rouge">SELECT MAX("字段名") FROM "表格名"</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 列出表 Orders 字段 OrderPrice 列最大值，</span>
<span class="c1">-- 结果集列不显示 OrderPrice 显示 LargestOrderPrice</span>
<span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">OrderPrice</span><span class="p">)</span> <span class="k">AS</span> <span class="n">LargestOrderPrice</span> <span class="k">FROM</span> <span class="n">Orders</span>
</code></pre></div></div><h2 id="触发器">触发器</h2><blockquote><p>语法： create trigger <触发器名称> { before | after} # 之前或者之后出发 insert | update | delete # 指明了激活触发程序的语句的类型 on <表名> # 操作哪张表 for each row # 触发器的执行间隔，for each row 通知触发器每隔一行执行一次动作，而不是对整个表执行一次。</表名></触发器名称></p><触发器 SQL="" 语句=""> </触发器></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delimiter</span> <span class="err">$</span>
<span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">set_userdate</span> <span class="k">BEFORE</span> <span class="k">INSERT</span> 
<span class="k">on</span> <span class="nv">`message`</span>
<span class="k">for</span> <span class="k">EACH</span> <span class="k">ROW</span>
<span class="k">BEGIN</span>
  <span class="k">set</span> <span class="o">@</span><span class="n">statu</span> <span class="o">=</span> <span class="k">new</span><span class="p">.</span><span class="n">status</span><span class="p">;</span> <span class="c1">-- 声明复制变量 statu</span>
  <span class="n">if</span> <span class="o">@</span><span class="n">statu</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span>       <span class="c1">-- 判断 statu 是否等于 0</span>
    <span class="k">UPDATE</span> <span class="nv">`user_accounts`</span> <span class="k">SET</span> <span class="n">status</span><span class="o">=</span><span class="mi">1</span> <span class="k">WHERE</span> <span class="n">openid</span><span class="o">=</span><span class="k">NEW</span><span class="p">.</span><span class="n">openid</span><span class="p">;</span>
  <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
<span class="k">END</span>
<span class="err">$</span>
<span class="k">DELIMITER</span> <span class="p">;</span> <span class="c1">-- 恢复结束符号</span>
</code></pre></div></div><p>OLD 和 NEW 不区分大小写</p><ul><li>NEW 用 NEW.col_name，没有旧行。在 DELETE 触发程序中，仅能使用 OLD.col_name，没有新行。</li><li>OLD 用 OLD.col_name 来引用更新前的某一行的列</li></ul><h2 id="添加索引">添加索引</h2><h3 id="普通索引index">普通索引(INDEX)</h3><blockquote><p>语法：ALTER TABLE <code class="language-plaintext highlighter-rouge">表名字</code> ADD INDEX 索引名字 ( <code class="language-plaintext highlighter-rouge">字段名字</code> )</p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- –直接创建索引</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">index_user</span> <span class="k">ON</span> <span class="k">user</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="c1">-- –修改表结构的方式添加索引</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="k">ADD</span> <span class="k">INDEX</span> <span class="n">index_name</span> <span class="k">ON</span> <span class="p">(</span><span class="k">column</span><span class="p">(</span><span class="k">length</span><span class="p">))</span>
<span class="c1">-- 给 user 表中的 name字段 添加普通索引(INDEX)</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="nv">`table`</span> <span class="k">ADD</span> <span class="k">INDEX</span> <span class="n">index_name</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="c1">-- –创建表的时候同时创建索引</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`table`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="p">,</span>
    <span class="nv">`title`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span> <span class="k">COLLATE</span> <span class="n">utf8_general_ci</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="nv">`content`</span> <span class="nb">text</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span> <span class="k">COLLATE</span> <span class="n">utf8_general_ci</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="nv">`time`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
    <span class="k">INDEX</span> <span class="n">index_name</span> <span class="p">(</span><span class="n">title</span><span class="p">(</span><span class="k">length</span><span class="p">))</span>
<span class="p">)</span>
<span class="c1">-- –删除索引</span>
<span class="k">DROP</span> <span class="k">INDEX</span> <span class="n">index_name</span> <span class="k">ON</span> <span class="k">table</span>
</code></pre></div></div><h3 id="主键索引primary-key">主键索引(PRIMARY key)</h3><blockquote><p>语法：ALTER TABLE <code class="language-plaintext highlighter-rouge">表名字</code> ADD PRIMARY KEY ( <code class="language-plaintext highlighter-rouge">字段名字</code> )</p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 给 user 表中的 id字段 添加主键索引(PRIMARY key)</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="nv">`user`</span> <span class="k">ADD</span> <span class="k">PRIMARY</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">);</span>
</code></pre></div></div><h3 id="唯一索引unique">唯一索引(UNIQUE)</h3><blockquote><p>语法：ALTER TABLE <code class="language-plaintext highlighter-rouge">表名字</code> ADD UNIQUE (<code class="language-plaintext highlighter-rouge">字段名字</code>)</p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 给 user 表中的 creattime 字段添加唯一索引(UNIQUE)</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="nv">`user`</span> <span class="k">ADD</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">creattime</span><span class="p">);</span>
</code></pre></div></div><h3 id="全文索引fulltext">全文索引(FULLTEXT)</h3><blockquote><p>语法：ALTER TABLE <code class="language-plaintext highlighter-rouge">表名字</code> ADD FULLTEXT (<code class="language-plaintext highlighter-rouge">字段名字</code>)</p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 给 user 表中的 description 字段添加全文索引(FULLTEXT)</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="nv">`user`</span> <span class="k">ADD</span> <span class="n">FULLTEXT</span> <span class="p">(</span><span class="n">description</span><span class="p">);</span>
</code></pre></div></div><h3 id="添加多列索引">添加多列索引</h3><blockquote><p>语法： ALTER TABLE <code class="language-plaintext highlighter-rouge">table_name</code> ADD INDEX index_name ( <code class="language-plaintext highlighter-rouge">column1</code>, <code class="language-plaintext highlighter-rouge">column2</code>, <code class="language-plaintext highlighter-rouge">column3</code>)</p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 给 user 表中的 name、city、age 字段添加名字为name_city_age的普通索引(INDEX)</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">user</span> <span class="k">ADD</span> <span class="k">INDEX</span> <span class="n">name_city_age</span> <span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">city</span><span class="p">,</span><span class="n">age</span><span class="p">);</span> 
</code></pre></div></div><h3 id="建立索引的时机">建立索引的时机</h3><p>在<code class="language-plaintext highlighter-rouge">WHERE</code>和<code class="language-plaintext highlighter-rouge">JOIN</code>中出现的列需要建立索引，但也不完全如此：</p><ul><li>MySQL 只对<code class="language-plaintext highlighter-rouge">&lt;</code>，<code class="language-plaintext highlighter-rouge">&lt;=</code>，<code class="language-plaintext highlighter-rouge">=</code>，<code class="language-plaintext highlighter-rouge">&gt;</code>，<code class="language-plaintext highlighter-rouge">&gt;=</code>，<code class="language-plaintext highlighter-rouge">BETWEEN</code>，<code class="language-plaintext highlighter-rouge">IN</code>使用索引</li><li>某些时候的<code class="language-plaintext highlighter-rouge">LIKE</code>也会使用索引。</li><li>在<code class="language-plaintext highlighter-rouge">LIKE</code>以通配符%和_开头作查询时，MySQL 不会使用索引。</li></ul><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 此时就需要对city和age建立索引，</span>
<span class="c1">-- 由于mytable表的userame也出现在了JOIN子句中，也有对它建立索引的必要。</span>
<span class="k">SELECT</span> <span class="n">t</span><span class="p">.</span><span class="n">Name</span>  
<span class="k">FROM</span> <span class="n">mytable</span> <span class="n">t</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">mytable</span> <span class="n">m</span> <span class="k">ON</span> <span class="n">t</span><span class="p">.</span><span class="n">Name</span><span class="o">=</span><span class="n">m</span><span class="p">.</span><span class="n">username</span> 
<span class="k">WHERE</span> <span class="n">m</span><span class="p">.</span><span class="n">age</span><span class="o">=</span><span class="mi">20</span> <span class="k">AND</span> <span class="n">m</span><span class="p">.</span><span class="n">city</span><span class="o">=</span><span class="s1">'上海'</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytable</span> <span class="k">WHERE</span> <span class="n">username</span> <span class="k">like</span><span class="s1">'admin%'</span><span class="p">;</span> <span class="c1">-- 而下句就不会使用：</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">mytable</span> <span class="n">WHEREt</span> <span class="n">Name</span> <span class="k">like</span><span class="s1">'%admin'</span><span class="p">;</span> <span class="c1">-- 因此，在使用LIKE时应注意以上的区别。</span>
</code></pre></div></div><p>索引的注意事项</p><ul><li>索引不会包含有 NULL 值的列</li><li>使用短索引</li><li>不要在列上进行运算 索引会失效</li></ul><h2 id="创建后表的修改">创建后表的修改</h2><h3 id="添加列">添加列</h3><blockquote><p>语法：<code class="language-plaintext highlighter-rouge">alter table 表名 add 列名 列数据类型 [after 插入位置];</code></p></blockquote><p>示例:</p><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 在表students的最后追加列 address: </span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">students</span> <span class="k">add</span> <span class="n">address</span> <span class="nb">char</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>
<span class="c1">-- 在名为 age 的列后插入列 birthday: </span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">students</span> <span class="k">add</span> <span class="n">birthday</span> <span class="nb">date</span> <span class="k">after</span> <span class="n">age</span><span class="p">;</span>
<span class="c1">-- 在名为 number_people 的列后插入列 weeks: </span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">students</span> <span class="k">add</span> <span class="k">column</span> <span class="nv">`weeks`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span> <span class="k">default</span> <span class="nv">""</span> <span class="k">after</span> <span class="nv">`number_people`</span><span class="p">;</span>
</code></pre></div></div><h3 id="修改列">修改列</h3><blockquote><p>语法：<code class="language-plaintext highlighter-rouge">alter table 表名 change 列名称 列新名称 新数据类型;</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 将表 tel 列改名为 telphone: </span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">students</span> <span class="n">change</span> <span class="n">tel</span> <span class="n">telphone</span> <span class="nb">char</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="k">default</span> <span class="nv">"-"</span><span class="p">;</span>
<span class="c1">-- 将 name 列的数据类型改为 char(16): </span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">students</span> <span class="n">change</span> <span class="n">name</span> <span class="n">name</span> <span class="nb">char</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">;</span>
<span class="c1">-- 修改 COMMENT 前面必须得有类型属性</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">students</span> <span class="n">change</span> <span class="n">name</span> <span class="n">name</span> <span class="nb">char</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="k">COMMENT</span> <span class="s1">'这里是名字'</span><span class="p">;</span>
<span class="c1">-- 修改列属性的时候 建议使用modify,不需要重建表</span>
<span class="c1">-- change用于修改列名字，这个需要重建表</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">meeting</span> <span class="k">modify</span> <span class="nv">`weeks`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="nv">""</span> <span class="k">COMMENT</span> <span class="nv">"开放日期 周一到周日：0~6，间隔用英文逗号隔开"</span><span class="p">;</span>
<span class="c1">-- `user`表的`id`列，修改成字符串类型长度50，不能为空，`FIRST`放在第一列的位置</span>
<span class="k">alter</span> <span class="k">table</span> <span class="nv">`user`</span> <span class="k">modify</span> <span class="k">COLUMN</span> <span class="nv">`id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FIRST</span> <span class="p">;</span>
</code></pre></div></div><h3 id="删除列">删除列</h3><blockquote><p>语法：<code class="language-plaintext highlighter-rouge">alter table 表名 drop 列名称;</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 删除表students中的 birthday 列: </span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">students</span> <span class="k">drop</span> <span class="n">birthday</span><span class="p">;</span>
</code></pre></div></div><h3 id="重命名表">重命名表</h3><blockquote><p>语法：<code class="language-plaintext highlighter-rouge">alter table 表名 rename 新表名;</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 重命名 students 表为 workmates: </span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">students</span> <span class="k">rename</span> <span class="n">workmates</span><span class="p">;</span>
</code></pre></div></div><h3 id="清空表数据">清空表数据</h3><blockquote><p>方法一：<code class="language-plaintext highlighter-rouge">delete from 表名;</code> 方法二：<code class="language-plaintext highlighter-rouge">truncate from "表名";</code></p></blockquote><ul><li><code class="language-plaintext highlighter-rouge">DELETE:</code>1. DML 语言;2. 可以回退;3. 可以有条件的删除;</li><li><code class="language-plaintext highlighter-rouge">TRUNCATE:</code>1. DDL 语言;2. 无法回退;3. 默认所有的表内容都删除;4. 删除速度比 delete 快。</li></ul><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 清空表为 workmates 里面的数据，不删除表。 </span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">workmates</span><span class="p">;</span>
<span class="c1">-- 删除workmates表中的所有数据，且无法恢复</span>
<span class="k">truncate</span> <span class="k">from</span> <span class="n">workmates</span><span class="p">;</span>
</code></pre></div></div><h3 id="删除整张表">删除整张表</h3><blockquote><p>语法：<code class="language-plaintext highlighter-rouge">drop table 表名;</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 删除 workmates 表: </span>
<span class="k">drop</span> <span class="k">table</span> <span class="n">workmates</span><span class="p">;</span>
</code></pre></div></div><h3 id="删除整个数据库">删除整个数据库</h3><blockquote><p>语法：<code class="language-plaintext highlighter-rouge">drop database 数据库名;</code></p></blockquote><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 删除 samp_db 数据库: </span>
<span class="k">drop</span> <span class="k">database</span> <span class="n">samp_db</span><span class="p">;</span>
</code></pre></div></div><h2 id="其它实例">其它实例</h2><h3 id="sql-删除重复记录">SQL 删除重复记录</h3><p><a href="http://www.xiangguo.li/sql_and_nosql/2015/01/01/sql">转载</a></p><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 查找表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">people</span> <span class="k">where</span> <span class="n">peopleId</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">peopleId</span> <span class="k">from</span> <span class="n">people</span> <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="n">peopleId</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">-- 删除表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断，只留有rowid最小的记录</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">people</span> 
<span class="k">where</span> <span class="n">peopleId</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">peopleId</span> <span class="k">from</span> <span class="n">people</span> <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="n">peopleId</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">and</span> <span class="n">rowid</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">rowid</span><span class="p">)</span> <span class="k">from</span> <span class="n">people</span> <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="n">peopleId</span> <span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">-- 查找表中多余的重复记录（多个字段）</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">vitae</span> <span class="n">a</span>
<span class="k">where</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">peopleId</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">seq</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> <span class="k">from</span> <span class="n">vitae</span> <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">-- 删除表中多余的重复记录（多个字段），只留有rowid最小的记录</span>
<span class="k">delete</span> <span class="k">from</span> <span class="n">vitae</span> <span class="n">a</span>
<span class="k">where</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">peopleId</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">seq</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> <span class="k">from</span> <span class="n">vitae</span> <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">and</span> <span class="n">rowid</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">rowid</span><span class="p">)</span> <span class="k">from</span> <span class="n">vitae</span> <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">-- 查找表中多余的重复记录（多个字段），不包含rowid最小的记录</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">vitae</span> <span class="n">a</span>
<span class="k">where</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">peopleId</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">seq</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> <span class="k">from</span> <span class="n">vitae</span> <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">and</span> <span class="n">rowid</span> <span class="k">not</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="k">min</span><span class="p">(</span><span class="n">rowid</span><span class="p">)</span> <span class="k">from</span> <span class="n">vitae</span> <span class="k">group</span> <span class="k">by</span> <span class="n">peopleId</span><span class="p">,</span><span class="n">seq</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div><h2 id="参考手册">参考手册</h2><ul><li>http://www.w3school.com.cn/sql/index.asp</li><li>http://www.1keydata.com/cn/sql/sql-count.php</li></ul><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="http://zhangjinmiao.github.io" target="_blank">Zhang jinmiao</a></li><li>本文链接：<a href="http://zhangjinmiao.github.io/mysql/2018/04/24/21%E5%88%86%E9%92%9FMysql%E6%95%99%E7%A8%8B.html" target="_blank">http://zhangjinmiao.github.io/mysql/2018/04/24/21%E5%88%86%E9%92%9FMysql%E6%95%99%E7%A8%8B.html</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"><div class="share-component" data-disabled='qq,facebook'></div></div><div class="comment"> <script src="https://beaudar.lipk.org/client.js" repo="zhangjinmiao/blog-comments" issue-term="title" label="gitment" theme="github-light" comment-order="desc" input-position="top" crossorigin="anonymous" async> </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@built/assets/search_data.json?v=1660720056', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2015 <span title="Zhang jinmiao">Zhang jinmiao</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/zhangjinmiao/zhangjinmiao.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="http://zhangjinmiao.github.io/links.html" title="链接" target="_blank">链接</a></li><li> <a href="http://zhangjinmiao.github.io/used-urls.html" title="网址" target="_blank">网址</a></li><li> <a href="http://zhangjinmiao.github.io/money.html" title="挣钱" target="_blank">挣钱</a></li><li> <a href="http://zhangjinmiao.github.io/todo.html" title="TODO" target="_blank">TODO</a></li><li> <a href="http://zhangjinmiao.github.io/open-source.html" title="Code" target="_blank">Code</a></li><li><a href="http://zhangjinmiao.github.io"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div><div class="site-footer" role="contentinfo" style="padding-top:0px;border-top:none;"><div style="text-align:center;"> <a target="_blank" style="color:#777" href="http://beian.miit.gov.cn/">晋ICP备19009201号-1</a></div><div style="text-align:center"> <img src="http://zhangjinmiao.github.io/assets/images/2019/备案图标.png"> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802029536" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="" style="float:left;"/><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">京公网安备 11010802029536号</p></a></div><div class="mobile-hidden" style="text-align:center;" > <span id="busuanzi_container_site_pv">本站总访问量:<span id="busuanzi_value_site_pv"></span>次/</span> <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人/</span> <span id="busuanzi_container_page_pv">本页访问量<span id="busuanzi_value_page_pv"></span>次/</span> 统计始于2018-03-12 <span id="htmer_time"></span></div><script async src="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script> <script language=JavaScript> function secondToDate(second) { if (!second) { return 0; } var time = new Array(0, 0, 0, 0, 0); if (second >= 365 * 24 * 3600) { time[0] = parseInt(second / (365 * 24 * 3600)); second %= 365 * 24 * 3600; } if (second >= 24 * 3600) { time[1] = parseInt(second / (24 * 3600)); second %= 24 * 3600; } if (second >= 3600) { time[2] = parseInt(second / 3600); second %= 3600; } if (second >= 60) { time[3] = parseInt(second / 60); second %= 60; } if (second > 0) { time[4] = second; } return time; } </script> <script type="text/javascript" language="javascript"> function setTime() { var create_time = Math.round(new Date(Date.UTC(2018, 3, 12, 0, 0, 0)).getTime() / 1000); var timestamp = Math.round((new Date().getTime() + 8 * 60 * 60 * 1000) / 1000); currentTime = secondToDate((timestamp - create_time)); currentTimeHtml = '默默运行了' + currentTime[0] + '年' + currentTime[1] + '天' + currentTime[2] + '时' + currentTime[3] + '分' + currentTime[4] + '秒'; document.getElementById("htmer_time").innerHTML = currentTimeHtml; } setInterval(setTime, 1000); </script></div></footer><script src="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/zhangjinmiao/zhangjinmiao.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
